var REGEX={email:/^[a-z][a-z0-9_.]{4,32}@[a-z0-9]{2,}(.[a-z0-9]{2,4}){1,2}$/gi,phone:/^(0)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-9]|9[0-4|6-9])[0-9]{7}$/g,url:/(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/=]*)/g,date:/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{4})$/g,password:/(?=(.*[0-9]))(?=.*[\!@#$%^&*()\\[\]{}\-_+=~`|:;"'<>,.\/?])(?=.*[a-z])(?=(.*[A-Z]))(?=(.*)).{4,}/g,cccd:/^(0(?:0[12468]|1[0124579]|2[024-7]|3[013-8]|4[0245689]|5[12468]|6[024678]|7[024579]|8[0234679]|9[1-6])[0-9]{9})$/g,ho_chieu:/^([a-z][0-9]{7})$/gi,cmt:/^(?:0(?:[1-8][0-9]{7}|9[0125][0-9]{6})|1(?:[0-9][0-9]{7})|2(?:[0-79][0-9]{7}|(?:8[015]|3[01]|4[5])[0-9]{6})|3(?:[0-8][0-9]{7}))$/g,province_code:/^(?:0(?:[1-9]|9[0125])|1(?:[0-9])|2(?:[0-79]|8[015]|3[01]|4[5])|3(?:[0-8]))$/g,empty:/^\s*$/};(function(){"use strict";var MESSAGE_empty="Không được để trống",MESSAGE_string_min="%{label} phải nhiều hơn %{num} ký tự",MESSAGE_string_max="%{label} phải ít hơn %{num} ký tự",MESSAGE_number_min="%{label} phải lớn hơn %{num}",MESSAGE_number_max="%{label} phải nhỏ hơn %{num}",MESSAGE_wrong_format="%{label} không đúng định dạng",TYPE=["string","number","phone","email","url","date","password","cccd_hc","age"],PARAM_message="message",PARAM_regex="regex",PARAM_value="value",PARAM_toDate="toDate",PARAM_type="type",validate=function(formFields,rules){return _.test(formFields,rules)},_=validate;_.extend=function(obj){return[].slice.call(arguments).forEach((function(source){for(var attr in source)obj[attr]=source[attr]})),obj},_.extend(validate,{exposeModule:function(validate,root){root.validate=validate}}),_.extend(validate,{test:function(formFields,rules){var testResult={errors:!1,fields:{}};for(var fieldname in rules){testResult.fields[fieldname]=[];var value=_.getFieldValue(formFields,fieldname),rulesOfField=rules[fieldname].hasOwnProperty("rule")?rules[fieldname].rule:void 0;if(void 0!==value){var isRequired=_.isRequired(rulesOfField),type=_.getFieldType(rules[fieldname]),label,fieldContent={label:_.getParams(rules[fieldname],"label"),type:type},formatTest;if(type)switch(type){case"email":formatTest=_.isEmail(value,rulesOfField,fieldContent);break;case"phone":formatTest=_.isPhone(value,rulesOfField,fieldContent);break;case"password":formatTest=_.isPassword(value,rulesOfField,fieldContent);break;case"url":formatTest=_.isUrl(value,rulesOfField,fieldContent);break;case"date":formatTest=_.isDate(value,rulesOfField,fieldContent);break;case"cccd_hc":formatTest=_.isCCCDHC(value,rulesOfField,fieldContent)}formatTest&&(testResult.errors=!0,testResult.fields[fieldname].push(formatTest)),rulesOfField&&Object.keys(rulesOfField).forEach((function(ruleName){var ruleDetail=rulesOfField[ruleName],result;switch(ruleName){case"require":result=_.validator.require(value,ruleDetail);break;case"min":result=_.validator.min(value,ruleDetail,fieldContent);break;case"max":result=_.validator.max(value,ruleDetail,fieldContent);break;case"format":result=_.validator.format(value,ruleDetail,fieldContent);break;case"length":result=_.validator.length(value,ruleDetail,fieldContent)}result&&(isRequired||!isRequired&&value.length>0)&&(testResult.errors=!0,testResult.fields[fieldname].push(result))}))}}return testResult},getFieldValue:function(formFields,fieldname){if(_.isObject(formFields)&&_.isString(fieldname))return formFields.hasOwnProperty(fieldname)?formFields[fieldname].trim():void 0},getFieldType:function(formFields){return _.isObject(formFields)&&formFields.hasOwnProperty("type")&&TYPE.includes(formFields.type)?formFields.type:"string"},getParams:function(fields,param){try{return fields.hasOwnProperty(param)?fields[param]:void 0}catch(e){return}},renderMessage:function(message,additions){if(!_.isString(message))return message;var mReg=/(%?)%\{([^\}]+)\}/g;return message.replace(mReg,(function(m0,m1,m2){return"%"===m1?"%{"+m2+"}":String(additions[m2]||"")}))}}),_.validator={require:function(value,rule){if(_.isEmpty(value))return _.getParams(rule,PARAM_message)||MESSAGE_empty},min:function(value,rule,field){var length=_.getParams(rule,PARAM_value);if(length&&_.isInteger(length)&&!(length<0)){var params={num:length,label:_.getParams(field,"label")};if("age"===field.type){if(!_.isAgeValid(value,rule,"min"))return _.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_number_min,params)}else if("number"===field.type){if(!_.isNumber(value)||value<length)return _.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_number_min,params)}else if("date"===field.type);else if(value&&value.length<length)return _.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_string_min,params)}},max:function(value,rule,field){var length=_.getParams(rule,PARAM_value);if(length&&_.isInteger(length)&&!(length<0)){var params={num:length,label:_.getParams(field,"label")};if("age"===field.type){if(!_.isAgeValid(value,rule,"max"))return _.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_number_min,params)}else if("number"===field.type){if(!_.isNumber(value)||value>length)return _.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_number_max,params)}else if("date"===field.type);else if(value&&value.length>length)return _.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_string_max,params)}},length:function(value,rule,field){var length=_.getParams(rule,PARAM_value);if(length&&_.isInteger(length)&&!(length<0)){var params={num:length,label:_.getParams(field,"label")};return value&&value.length!==length?_.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_wrong_format,params):void 0}},format:function(value,rule,field){var regex=_.getParams(rule,PARAM_value)||_.getParams(rule,PARAM_regex)||void 0;if(_.isString(value)&&regex){var params={label:_.getParams(field,"label")},reg=new RegExp(regex);return value&&!reg.test(value)?_.renderMessage(_.getParams(rule,PARAM_message)||MESSAGE_wrong_format,params):void 0}}},_.extend(validate,{isEmail:function(value,rule,field){var _rule=Object.assign(rule||{},{regex:REGEX.email});return _.validator.format(value,_rule,field)},isPhone:function(value,rule,field){var _rule=Object.assign(rule||{},{regex:REGEX.phone});return _.validator.format(value,_rule,field)},isUrl:function(value,rule,field){var _rule=Object.assign(rule||{},{regex:REGEX.url});return _.validator.format(value,_rule,field)},isDate:function(value,rule,field){var _rule=Object.assign(rule||{},{regex:REGEX.date});return _.validator.format(value,_rule,field)},isPassword:function(value,rule,field){var _rule=Object.assign(rule||{},{regex:REGEX.password});return _.validator.format(value,_rule,field)},isCCCDHC:function(value,rule,field){var isError=_.validator.format(value,Object.assign(rule||{},{regex:REGEX.cmt}),field);isError&&isError.length&&(isError=_.validator.format(value,Object.assign(rule||{},{regex:REGEX.cccd}),field)),isError&&isError.length&&(isError=_.validator.format(value,Object.assign(rule||{},{regex:REGEX.ho_chieu}),field));var regexp=/^[0-9a-z]{10,11}$/gi;return isError&&isError.length&&(isError=_.validator.format(value,Object.assign(rule||{},{regex:regexp}),field)),isError},isAgeValid:function(value,rule,type){const dayCompare=_.getParams(rule,PARAM_toDate),expect_age=_.getParams(rule,PARAM_value),checkType=_.getParams(rule,PARAM_type);var actual_age=_.getAgeByDob(value,dayCompare,checkType);if(actual_age>=0){if("min"===type)return expect_age<=actual_age;if("max"===type)return expect_age>=actual_age}return!1}}),_.extend(validate,{isRequired:function(rule){return rule&&void 0!==rule.require&&_.getParams(rule.require,"value")||!1},isObject:function(obj){return obj===Object(obj)},isString:function(value){return"string"==typeof value},isNumber:function(value){return"number"==typeof value||!isNaN(value)&&!isNaN(parseFloat(value))},isInteger:function(value){return _.isNumber(value)&&value%1==0},isFunction:function(value){return"function"==typeof value},isBoolean:function(value){return"boolean"==typeof value},isDateTime:function(value){var reg=new RegExp(REGEX.date);return value instanceof Date||reg.test(value)},isEmpty:function(value){var attr;return null==value||!this.isFunction(value)&&(this.isString(value)?REGEX.empty.test(value):this.isArray(value)?0===value.length:(this.isDateTime(value),!1))}}),_.getAgeByDob=function(day,dayCompare,checkType){var reg=new RegExp(REGEX.date);if(!day||!reg.test(day))return null;checkType=checkType||"y";var today=new Date,datearray=day.split("/"),newdate=datearray[1]+"/"+datearray[0]+"/"+datearray[2],newDayCompare=dayCompare?dayCompare.split("/"):null,dob=new Date(newdate),ngayCheck=dayCompare?new Date(newDayCompare[1]+"/"+newDayCompare[0]+"/"+newDayCompare[2]):today,months;if("d"==checkType.toLowerCase()){var result=Math.floor((ngayCheck-dob)/864e5);return isNaN(result)?null:result}if("m"==checkType.toLowerCase())return months=12*(ngayCheck.getFullYear()-dob.getFullYear()),months-=dob.getMonth(),months+=ngayCheck.getMonth(),isNaN(months)?null:months;if("y"==checkType.toLowerCase()){var result=Math.floor((ngayCheck-dob)/315576e5);return isNaN(result)?null:result}return 0};var DEFAULT_CONFIG={phone:{type:"phone",label:"Số điện thoại",rule:{require:{value:!0}}},cccd_hc:{type:"cccd_hc",label:"Số CMT/CCCD/HC",rule:{require:{value:!0}}},email:{type:"email",label:"Email",rule:{format:{message:"Email không đúng định dạng"}}},password:{type:"password",label:"Mật khẩu",rule:{min:{value:6,message:"Mật khẩu tối thiểu 6 ký tự"}}}};_.form=function(fields){if(fields&&0!==fields.length){var config={},form_field={};return fields.map(item=>{var field_name=item.field,field_value=item.value,field_config=item.config;field_name&&field_value&&(void 0!==DEFAULT_CONFIG[field_name]&&(field_config=field_config||DEFAULT_CONFIG[field_name]),field_config&&(config[field_name]=field_config,form_field[field_name]=field_value))}),Object.keys(config).length>0&&Object.keys(form_field).length>0?validate(form_field,config):void 0}},validate.exposeModule(validate,this)}).call(this);